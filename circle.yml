machine:

  services:
    - docker
  environment:
    COUCHDB_NAME: ccitest
    COUCHDB_PUBLIC_URL: http://localhost
    COUCHDB_PUBLIC_PORT: 5988
    APP_PUBLIC_URL: http://localhost
    APP_PUBLIC_PORT: 3000

dependencies:
  override:
    - sudo pip install --upgrade docker-compose
    - npm install
    - ./node_modules/.bin/gulp build --production
    - docker-compose build
    - docker-compose pull

test:
  override:
    - docker-compose --no-color up
    - npm test:
        environment:
          MOCHA_DOCKER: true
