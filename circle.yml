machine:

  services:
    - docker
  environment:
    COUCHDB_NAME: ccitest

dependencies:
  override:
    - sudo pip install --upgrade docker-compose
    - npm install
    - ./node_modules/.bin/gulp build --production
    - docker-compose build
    - docker-compose pull

test:
  override:
    - docker-compose --no-color up:
        environment:
          COUCHDB_PUBLIC_URL: http://localhost
          COUCHDB_PUBLIC_PORT: 5988
    - npm test:
        environment:
          MOCHA_DOCKER: true
          APP_PUBLIC_URL: http://localhost
          APP_PUBLIC_PORT: 3000
          COUCHDB_PUBLIC_URL: http://localhost
          COUCHDB_PUBLIC_PORT: 5988
